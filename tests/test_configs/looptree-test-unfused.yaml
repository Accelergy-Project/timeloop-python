mapping:
  type: fused
  nodes:
  - type: storage
    target: 0
    dspace: [Filter1, Filter2, Fmap1, Fmap2, Fmap3]
  - type: sequential
    branches:
    - - type: storage
        target: 1
        dspace: [Filter1]
      - type: temporal
        rank: P1
        tile_shape: 1
      - type: storage
        target: 1
        dspace: [Fmap1]
      - type: spatial
        rank: M1
        tile_shape: 1
      - type: storage
        target: 2
        dspace: [Fmap2]
      - type: temporal
        rank: C1
        tile_shape: 1
      - type: compute
        einsum: Fc1
        target: 3
    - - type: storage
        target: 1
        dspace: [Filter2]
      - type: temporal
        rank: P2
        tile_shape: 1
      - type: storage
        target: 1
        dspace: [Fmap3]
      - type: spatial
        rank: M2
        tile_shape: 1
      - type: spatial
        rank: C2
        tile_shape: 1
      - type: storage
        target: 2
        dspace: [Fmap2]
      - type: compute
        einsum: Fc2
        target: 3

problem:
  - shape:
      name: Fc1
      dimensions: [ P1, M1, C1 ]
      data_spaces:
      - name: Fmap1
        dimensions: [ Fmap1_C, Fmap1_P ]
        projection: '[ C1, P1 ]'
      - name: Filter1
        dimensions: [ Filter1_C, Filter1_M ]
        projection: '[ C1, M1 ]'
      - name: Fmap2
        dimensions: [ Fmap2_C, Fmap2_P ]
        projection: '[ M1, P1 ]'
        read_write: True

    instance: >-
      0 <= P1 < 9 and 0 <= M1 < 4 and 0 <= C1 < 2

  - shape:
      name: Fc2
      dimensions: [ P2, M2, C2 ]
      data_spaces:
      - name: Fmap2
        dimensions: [ Fmap2_C, Fmap2_P ]
        projection: '[ C2, P2 ]'
      - name: Filter2
        dimensions: [ Filter2_C, Filter2_M ]
        projection: '[ C2, M2 ]'
      - name: Fmap3
        dimensions: [ Fmap3_C, Fmap3_P ]
        projection: '[ M2, P2 ]'
        read_write: True

    instance: >-
      0 <= P2 < 9 and 0 <= M2 < 8 and 0 <= C2 < 4

architecture:
  version: 0.4
  nodes:
  - !Component
    name: MainMemory
    class: DRAM
    attributes: {width: 256, block_size: 32, word_bits: 8, datawidth: 8}
  - !Component
    name: GlobalBuffer
    class: SRAM
    attributes: {depth: 8192, width: 256, block_size: 32, word_bits: 8, datawidth: 8}
  - !Component
    name: MACC
    class: intmac
    attributes: {datawidth: 8}
